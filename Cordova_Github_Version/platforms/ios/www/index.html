<html>
    <head>
        <title>Hello World</title>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
        <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
        <script type="text/javascript" charset="utf-8" src="js/index.js"></script>
        <script type="text/javascript" charset="utf-8">
        function success(result){
            document.getElementById("searchResult").innerHTML = "";
            document.getElementById("searchNb").innerHTML = result.nbHits + ' docs';
            var ul = document.getElementById("searchResult");
            if(result.nbHits > 0){
                for(var i=0; i<result.nbHits; i++) {
                    var li = document.createElement("li");
                    li.appendChild(document.createTextNode(result.docs[i].content));
                    ul.appendChild(li);
                }
            }
        }
        
        function failure(result){
            alert("failure");
        }
        
        function search() {
            var textValue = document.getElementById("myText").value;
            var indexPath = "lucene143/field";
            //cordova.file.documentsDirectory start with file:///
            LucenePlugin.init(indexPath, "content", 10);
            LucenePlugin.search(textValue, success, failure);
        }
        
        
        function downloadIndex(){
            var url = "http://weitaiping.com/lucene143.zip";
            var params = {};
            var headers = {};
            var filePath = cordova.file.documentsDirectory + "lucene143.zip";
            CordovaHttpPlugin.downloadFile(url, params, headers, filePath,
                                    function(entry) {
                                        unzipIndex(filePath);
                                    },
                                    function(response) {
                                        alert(response.error);
                                    });
        }
        
        function unzipIndex(fileName){
            var outputDirectory = cordova.file.documentsDirectory;
            
            zip.unzip(fileName, outputDirectory,
                      function(entry) {
                        alert("success");
                      },
                      function(response) {
                        //alert(response.error);
                      });
        }
        
        </script>
    </head>
    
    <body style="padding-top:20px;">
        <input id="myText" type="text"/>
        <input type="button" id="btn" onclick="downloadIndex()" value="download" />
        <input type="button" id="btn" onclick="search()" value="Search" />
        </br>
        <span id="searchNb">search number hits</span>
        </br>
        <div>
            <ul id="searchResult"></ul>
        </div>
    </body>
</html>
